{"ast":null,"code":"var _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.LocationSubscriber = exports.HeadingSubscriber = void 0;\nexports._getCurrentWatchId = _getCurrentWatchId;\nvar _classCallCheck2 = _interopRequireDefault(require(\"@babel/runtime/helpers/classCallCheck\"));\nvar _createClass2 = _interopRequireDefault(require(\"@babel/runtime/helpers/createClass\"));\nvar _ExpoLocation = _interopRequireDefault(require(\"./ExpoLocation\"));\nvar _LocationEventEmitter = require(\"./LocationEventEmitter\");\nvar nextWatchId = 0;\nvar Subscriber = function () {\n  function Subscriber(eventName, eventDataField) {\n    (0, _classCallCheck2.default)(this, Subscriber);\n    this.callbacks = {};\n    this.eventSubscription = null;\n    this.eventName = eventName;\n    this.eventDataField = eventDataField;\n  }\n  (0, _createClass2.default)(Subscriber, [{\n    key: \"maybeInitializeSubscription\",\n    value: function maybeInitializeSubscription() {\n      var _this = this;\n      if (this.eventSubscription) {\n        return;\n      }\n      this.eventSubscription = _LocationEventEmitter.LocationEventEmitter.addListener(this.eventName, function (event) {\n        return _this.trigger(event);\n      });\n    }\n  }, {\n    key: \"registerCallback\",\n    value: function registerCallback(callback) {\n      this.maybeInitializeSubscription();\n      var id = ++nextWatchId;\n      this.callbacks[id] = callback;\n      return id;\n    }\n  }, {\n    key: \"unregisterCallback\",\n    value: function unregisterCallback(id) {\n      if (!this.callbacks[id]) {\n        return;\n      }\n      delete this.callbacks[id];\n      _ExpoLocation.default.removeWatchAsync(id);\n      if (Object.keys(this.callbacks).length === 0 && this.eventSubscription) {\n        _LocationEventEmitter.LocationEventEmitter.removeSubscription(this.eventSubscription);\n        this.eventSubscription = null;\n      }\n    }\n  }, {\n    key: \"trigger\",\n    value: function trigger(event) {\n      var watchId = event.watchId;\n      var callback = this.callbacks[watchId];\n      if (callback) {\n        callback(event[this.eventDataField]);\n      } else {\n        _ExpoLocation.default.removeWatchAsync(watchId);\n      }\n    }\n  }]);\n  return Subscriber;\n}();\nvar LocationSubscriber = new Subscriber('Expo.locationChanged', 'location');\nexports.LocationSubscriber = LocationSubscriber;\nvar HeadingSubscriber = new Subscriber('Expo.headingChanged', 'heading');\nexports.HeadingSubscriber = HeadingSubscriber;\nfunction _getCurrentWatchId() {\n  return nextWatchId;\n}","map":{"version":3,"names":["_ExpoLocation","_interopRequireDefault","require","_LocationEventEmitter","nextWatchId","Subscriber","eventName","eventDataField","_classCallCheck2","default","callbacks","eventSubscription","_createClass2","key","value","maybeInitializeSubscription","_this","LocationEventEmitter","addListener","event","trigger","registerCallback","callback","id","unregisterCallback","ExpoLocation","removeWatchAsync","Object","keys","length","removeSubscription","watchId","LocationSubscriber","exports","HeadingSubscriber","_getCurrentWatchId"],"sources":["D:\\vikash\\AgroIntelPro-RN-App\\node_modules\\expo-location\\src\\LocationSubscribers.ts"],"sourcesContent":["import { Subscription } from 'expo-modules-core';\n\nimport ExpoLocation from './ExpoLocation';\nimport { LocationCallback, LocationHeadingCallback } from './Location.types';\nimport { LocationEventEmitter } from './LocationEventEmitter';\n\ntype EventObject = {\n  watchId: number;\n  [key: string]: any;\n};\n\nlet nextWatchId = 0;\n\nclass Subscriber<CallbackType extends LocationCallback | LocationHeadingCallback> {\n  private eventName: string;\n  private eventDataField: string;\n  private callbacks: { [id: string]: CallbackType } = {};\n  private eventSubscription: Subscription | null = null;\n\n  constructor(eventName: string, eventDataField: string) {\n    this.eventName = eventName;\n    this.eventDataField = eventDataField;\n  }\n\n  maybeInitializeSubscription() {\n    if (this.eventSubscription) {\n      return;\n    }\n    this.eventSubscription = LocationEventEmitter.addListener(\n      this.eventName,\n      (event: EventObject) => this.trigger(event)\n    );\n  }\n\n  /**\n   * Registers given callback under new id which is then returned.\n   */\n  registerCallback(callback: CallbackType): number {\n    this.maybeInitializeSubscription();\n    const id = ++nextWatchId;\n    this.callbacks[id] = callback;\n    return id;\n  }\n\n  /**\n   * Unregisters a callback with given id and revokes the subscription if possible.\n   */\n  unregisterCallback(id: number): void {\n    // Do nothing if we have already unregistered the callback.\n    if (!this.callbacks[id]) {\n      return;\n    }\n\n    delete this.callbacks[id];\n    ExpoLocation.removeWatchAsync(id);\n\n    if (Object.keys(this.callbacks).length === 0 && this.eventSubscription) {\n      LocationEventEmitter.removeSubscription(this.eventSubscription);\n      this.eventSubscription = null;\n    }\n  }\n\n  trigger(event: EventObject): void {\n    const watchId = event.watchId;\n    const callback = this.callbacks[watchId];\n\n    if (callback) {\n      callback(event[this.eventDataField]);\n    } else {\n      ExpoLocation.removeWatchAsync(watchId);\n    }\n  }\n}\n\nexport const LocationSubscriber = new Subscriber<LocationCallback>(\n  'Expo.locationChanged',\n  'location'\n);\nexport const HeadingSubscriber = new Subscriber<LocationHeadingCallback>(\n  'Expo.headingChanged',\n  'heading'\n);\n\n/**\n * @private Necessary for some unit tests.\n */\nexport function _getCurrentWatchId(): number {\n  return nextWatchId;\n}\n"],"mappings":";;;;;;;;AAEA,IAAAA,aAAA,GAAAC,sBAAA,CAAAC,OAAA;AAEA,IAAAC,qBAAA,GAAAD,OAAA;AAOA,IAAIE,WAAW,GAAG,CAAC;AAAC,IAEdC,UAAU;EAMd,SAAAA,WAAYC,SAAiB,EAAEC,cAAsB;IAAA,IAAAC,gBAAA,CAAAC,OAAA,QAAAJ,UAAA;IAAA,KAH7CK,SAAS,GAAmC,EAAE;IAAA,KAC9CC,iBAAiB,GAAwB,IAAI;IAGnD,IAAI,CAACL,SAAS,GAAGA,SAAS;IAC1B,IAAI,CAACC,cAAc,GAAGA,cAAc;EACtC;EAAC,IAAAK,aAAA,CAAAH,OAAA,EAAAJ,UAAA;IAAAQ,GAAA;IAAAC,KAAA,EAED,SAAAC,4BAAA,EAA2B;MAAA,IAAAC,KAAA;MACzB,IAAI,IAAI,CAACL,iBAAiB,EAAE;QAC1B;;MAEF,IAAI,CAACA,iBAAiB,GAAGM,0CAAoB,CAACC,WAAW,CACvD,IAAI,CAACZ,SAAS,EACd,UAACa,KAAkB;QAAA,OAAKH,KAAI,CAACI,OAAO,CAACD,KAAK,CAAC;MAAA,EAC5C;IACH;EAAC;IAAAN,GAAA;IAAAC,KAAA,EAKD,SAAAO,iBAAiBC,QAAsB;MACrC,IAAI,CAACP,2BAA2B,EAAE;MAClC,IAAMQ,EAAE,GAAG,EAAEnB,WAAW;MACxB,IAAI,CAACM,SAAS,CAACa,EAAE,CAAC,GAAGD,QAAQ;MAC7B,OAAOC,EAAE;IACX;EAAC;IAAAV,GAAA;IAAAC,KAAA,EAKD,SAAAU,mBAAmBD,EAAU;MAE3B,IAAI,CAAC,IAAI,CAACb,SAAS,CAACa,EAAE,CAAC,EAAE;QACvB;;MAGF,OAAO,IAAI,CAACb,SAAS,CAACa,EAAE,CAAC;MACzBE,qBAAY,CAACC,gBAAgB,CAACH,EAAE,CAAC;MAEjC,IAAII,MAAM,CAACC,IAAI,CAAC,IAAI,CAAClB,SAAS,CAAC,CAACmB,MAAM,KAAK,CAAC,IAAI,IAAI,CAAClB,iBAAiB,EAAE;QACtEM,0CAAoB,CAACa,kBAAkB,CAAC,IAAI,CAACnB,iBAAiB,CAAC;QAC/D,IAAI,CAACA,iBAAiB,GAAG,IAAI;;IAEjC;EAAC;IAAAE,GAAA;IAAAC,KAAA,EAED,SAAAM,QAAQD,KAAkB;MACxB,IAAMY,OAAO,GAAGZ,KAAK,CAACY,OAAO;MAC7B,IAAMT,QAAQ,GAAG,IAAI,CAACZ,SAAS,CAACqB,OAAO,CAAC;MAExC,IAAIT,QAAQ,EAAE;QACZA,QAAQ,CAACH,KAAK,CAAC,IAAI,CAACZ,cAAc,CAAC,CAAC;OACrC,MAAM;QACLkB,qBAAY,CAACC,gBAAgB,CAACK,OAAO,CAAC;;IAE1C;EAAC;EAAA,OAAA1B,UAAA;AAAA;AAGI,IAAM2B,kBAAkB,GAAG,IAAI3B,UAAU,CAC9C,sBAAsB,EACtB,UAAU,CACX;AAAC4B,OAAA,CAAAD,kBAAA,GAAAA,kBAAA;AACK,IAAME,iBAAiB,GAAG,IAAI7B,UAAU,CAC7C,qBAAqB,EACrB,SAAS,CACV;AAAC4B,OAAA,CAAAC,iBAAA,GAAAA,iBAAA;AAKI,SAAUC,kBAAkBA,CAAA;EAChC,OAAO/B,WAAW;AACpB"},"metadata":{},"sourceType":"script","externalDependencies":[]}